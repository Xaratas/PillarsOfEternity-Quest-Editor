<link rel="import" href="bower_components/iron-input/iron-input.html">
<link rel="import" href="FlowChartNode-behavior.html">
<link rel="import" href="comment-element.html">

<dom-module id="ObjectiveNode-element">
<style>
	:host {
		background-color: #ccc;
		width: 200px;
		display: flex;
	    flex-direction: column;
		margin: 10px;
		padding: 5px;
	}

	.direction {
		float: right;
	}

	comments {
	}
</style>
<template>
		<div>Type: <span>{{type}}</span><span class="direction">{{direction}}</span></div>
		<div>ID: <input is="iron-input" bind-value={{nodeId}}></input></div>
		<div>Comments: <button on-click="addComment">Add</button></div>
		<comments></comments>
</template>
</dom-module>

<dom-module id="TalkNode-element">
<style>
	:host {
		background-color: #aaddaa;
		width: 200px;
		display: flex;
	    flex-direction: column;
		margin: 10px;
		padding: 5px;
	}

	.direction {
		float: right;
	}

	comments {
	}
</style>
<template>
		<div>Type: <span>{{type}}</span><span class="direction">{{direction}}</span></div>
		<div>ID: <input is="iron-input" bind-value={{nodeId}}></input></div>
		<div>Comments: <button on-click="addComment">Add</button></div>
		<comments></comments>
</template>
</dom-module>


<script>
	ObjectiveNode = Polymer({
		is: "ObjectiveNode-element",
		behaviors: [FlowChartNodeBehavior],

        created: function() {
            this.comments = [];
            this.links = {};
        },
        
		createLink: function(to) {
			if(!(to.id in this.links)) {
				this.links[to.id] = new QuestLink(this, to);
				document.getElementsByTagName("body")[0].appendChild(this.links[to.id]);
			}
		},



		fromXML: function(xml) {
			if(xml.hasChildNodes()) {
				this.type = xml.attributes[0].value;
				var node;
				for(node of xml.childNodes) {
					if(node.nodeName == "NodeID") {
						this.nodeId = node.childNodes[0].nodeValue;
					}
					if(node.nodeName == "Comments") {
						var cnode;
						for(cnode of node.childNodes) {
							this.addComment(cnode.textContent);
						}
					}
					// andere werte
				}
			}	
		},

		toXML: function() {
			var result = '<FlowChartNode xsi:type="' + this.type + '">'
						+ "<NodeID>" + this.nodeId + "</NodeID><Comments>";
			for(comment of this.comments) {
				result += comment.toXML();
			}
			result += "</Comments>";
			result += "<PackageID>1</PackageID>"; // siehe xsd, 1 steht für base game und ist momentan der Einzige sinnvolle Wert 
            result += "<ContainerNodeID>-1</ContainerNodeID>"; // todo ?
            result += "<Links>";
            for(link in this.links) {
				result += link.toXML();
			}
            result += "</Links>";
			return result + "</FlowChartNode>";
		}
	});

    TalkNode = Polymer({
        is: "TalkNode-element",
		behaviors: [FlowChartNodeBehavior],

        created: function() {
            this.comments = [];
            this.links = {};
        },

        createLink: function(to) {
			if(!(to.id in this.links)) {
				this.links[to.id] = new DialogueLink(this, to);	
				document.getElementsByTagName("body")[0].appendChild(this.links[to.id]);
			}
		},

        createTempLink: function(toID) {
            
        },

		fromXML: function(xml) {
			if(xml.hasChildNodes()) {
				this.type = xml.attributes[0].value;
				var node;
				for(node of xml.childNodes) {
					if(node.nodeName == "NodeID") {
						this.nodeId = node.childNodes[0].nodeValue;
					}
					if(node.nodeName == "Comments") {
						var cnode;
						for(cnode of node.childNodes) {
							this.addComment(cnode.textContent);
						}
					}
                    if(node.nodeName == "Links") {
                        var lnode;
                        for(lnode of node.childNodes) {
                            //this.createLink(?); // node existiert noch nicht
                        }
                    }
					// andere werte
				}
			}	
		},

		toXML: function() {
			var result = '<FlowChartNode xsi:type="' + this.type + '">'
						+ "<NodeID>" + this.nodeId + "</NodeID><Comments>";
			for(comment of this.comments) {
				result += comment.toXML();
			}
			result += "</Comments>";
			result += "<PackageID>1</PackageID>"; // siehe xsd, 1 steht für base game und ist momentan der Einzige sinnvolle Wert
            result += "<ContainerNodeID>-1</ContainerNodeID>"; // todo ?
            result += "<Links>";
            for(link in this.links) {
				result += link.toXML();
			}
            result += "</Links>";
			return result + "</FlowChartNode>";
		}
    });
</script>