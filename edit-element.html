<link rel="import" href="bower_components/iron-input/iron-input.html">

<dom-module id="edit-element">
	<style>
	:host {
		display: flex;
	}

	.label, editControl {
		flex-grow: 1;
		width: 30%;
	}

	</style>
	<template>
		<div class="label">{{label}}</div>
		<editControl id="editControl">
			<input id="input" is="iron-input" bind-value="{{value}}" hidden="true"></input>
		</editControl>
		<div>
			<button>?</button>
		</div>
	</template>
</dom-module>

<script>
"use strict";
	var EditElement = Polymer({
		is: 'edit-element',

		properties: {
			label: String,
			type: {
				type: String,
				observer: 'typeChanged'
			},
			helpText: String,

			value: {
				type: String,
				notify: true,
				observer: 'valueChanged'
			},

			options: {
				type: Array,
				value: function() { return []; }
			}
		},
		// ich wei√ü nicht was zu erst dran ist, in ff ist es value, in chrome und ie type
		// slack-channel: sjmiles 23:57 @xaratas: property change order is not guaranteed, use explicit dependencies in observers 
		typeChanged: function(newValue) {
			if(this.value != undefined) {
				this.setup();
			}
		},
		valueChanged: function(newValue) {
			if(this.type != undefined) {
				this.setup();
			}
		},

		setup: function() {
			if(this.type == "select") {
				this.asSelect(this.options, this.value);
			}
			if(this.type == "input") {
				this.asInput(this.value);
			}
			if(this.type == "text") {
				this.asText(this.options, this.value);
			}
		},

		asSelect: function(options, value) {
			var	betterSelect = new BetterSelect(options, value);
			this.$.editControl.appendChild(betterSelect);
		},
		 
		asInput: function(value) {
			this.value = value;
			this.$.input.hidden = false;
		},

		asText: function(options, value) {
			var text = "";
			// momentan ist value eine guid, finde den instancetag dazu
			for(var i = 0; i < options.length; i++) {
				if(options[i].guid == value) {
					text  = options[i].instanceTag;
					break;
				}
			}
			var span = document.createElement("span");
			span.innerHTML = text;
			this.$.editControl.appendChild(span);
		}

	});
</script>
