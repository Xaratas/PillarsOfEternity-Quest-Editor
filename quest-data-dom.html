<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="ParserBehavior.html">
<link rel="import" href="flowChartNode2-element.html">
<script>
	QuestData = Polymer({
		is: "QuestData-dom",
        behaviors: [ParserBehavior],

		created: function() {
            this.type = "QuestData";
			this.nodes = [];
			this.nodesMap = {};
        },

		// geht erstmal von text aus, hab noch kein file handling
		fromXML: function(xml) {
			if(typeof(xml) == "string") { // schon geparstes ist object
				xml = this.parser.parseFromString(xml, 'text/xml');
                this.cleanFormatting(xml);
			}
			if(xml.hasChildNodes()) {
                var item;
                for(item of xml.childNodes) {					
					if(item.nodeName == "#text") { continue; }
					if(item.nodeName == this.type) {
						this.fromXML(item); // remove outer layer
					}
					if(item.nodeName == "NextNodeID") {
						this.nextNodeId = item.childNodes[0].nodeValue;
					}
					if(item.nodeName == "Nodes") {
						// über alle
						var node, element;
						for(node of item.childNodes) {
							if(node.nodeName == "FlowChartNode") {
								element = new ObjectiveNode();
								element.fromXML(node);
							}
							// bookmarks, classextender, usw.
						    this.push("nodes", element);
							this.nodesMap[element.id] = element;
						}
						// dom anpassen
						for(node of this.nodes) {
							Polymer.dom(this).appendChild(node, this);
						}
                        // links aus dem Temp Status umformen
                        for(node of this.nodes) {
                            node.activateLinks(this.nodesMap);
                        }
					}
				}
			}
		},

		toXML: function() {
			var result = this.basetypecontent_toXML();
            // todo nicht gleiches
			return result + '</' + this.type + '>';
		}
	});

    ConversationData = Polymer({
        is: "ConversationData-dom",
        behaviors: [ParserBehavior],

        created: function() {
            this.type = "ConversationData";
			this.nodes = [];
			this.nodesMap = {};
        },

        fromXML: function(xml) {
			if(typeof(xml) == "string") { // schon geparstes ist object
				xml = this.parser.parseFromString(xml, 'text/xml');
                this.cleanFormatting(xml);
			}
			if(xml.hasChildNodes()) {
                var item;
                for(item of xml.childNodes) {
					if(item.nodeName == this.type) {
						this.fromXML(item); // remove outer layer
					}
					if(item.nodeName == "NextNodeID") {
						this.nextNodeId = item.childNodes[0].nodeValue;
					}
					if(item.nodeName == "Nodes") {
						// über alle
						var node, element;
						for(node of item.childNodes) {
							if(node.nodeName == "FlowChartNode") {
								element = new TalkNode();
								element.fromXML(node);
							}
							// bookmarks, classextender, usw.
						    this.push("nodes", element);
							this.nodesMap[element.id] = element;
						}
						// dom anpassen
						for(node of this.nodes) {
							Polymer.dom(this).appendChild(node, this);
						}
                        // links aus dem Temp Status umformen
                        for(node of this.nodes) {
                            node.activateLinks(this.nodesMap);
                        }
					}
				}
			}
		},

        toXML: function() {
			var result = this.basetypecontent_toXML();
            // todo nicht gleiches
			return result + '</' + this.type + '>';
		}
    });
</script>
